{"paragraphs":[{"text":"%pyspark\nimport csv\nimport pandas as pd\nimport json\n\n# file_path = \"/Users/camallen/Desktop/spark_tutorial/example_data/new-project-uq-classifications.csv\"\n# file_path = \"/Users/camallen/Desktop/spark_tutorial/example_data/cut_down_snapsatsea.csv\"\nfile_path = \"s3://zooniverse-data/emr_cam_testing/cut_down_snapsatsea.csv\"\n\n\nraw_csv_data = sc.emptyRDD()\n\n# the memory parameter is because this is a big file and some of the columns take a bit more processing, so I'm telling pandas not to take a shortcut\nclassifications = pd.read_csv(file_path, low_memory=False)\n# convert the annotations to json\nclassifications['annotations'] = [json.loads(anno) for anno in classifications.annotations]\nclassifications['metadata'] = [json.loads(meta) for meta in classifications.metadata]\n# store the major workflow versions\nclassifications['workflow_major'] = classifications.workflow_version.astype(int)\ncsv_data_df = sqlContext.createDataFrame(classifications)\ncsv_data_df.registerTempTable(\"classifications\")\n\n# convert the data frame to an RDD\ncsv_data_rdd = csv_data_df.rdd\n# and see some data\nprint(\"Total rows: %d\" % csv_data_rdd.count())\nsample = csv_data_rdd.sample(False,1, 12345).first()\nprint(\"Example row data:\")\nfor k, v in sample.asDict().items():\n    print(\"%s, %s\" % (k, v))","dateUpdated":"2017-06-20T20:55:37+0100","config":{"colWidth":12,"editorMode":"ace/mode/python","results":{},"enabled":true,"editorSetting":{"language":"python"}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Total rows: 5000\nExample row data:\nclassification_id, 11489039\nuser_id, 1475551.0\nexpert, nan\nworkflow_major, 4\nworkflow_name, -. Is there more than one whale or dolphin in this photo?\nannotations, [{u'task': u'init', u'task_label': u'Is there more than one whale or dolphin in this photo?', u'value': u'No, just one'}]\nuser_ip, 32068e4b3d793b60367d\nworkflow_id, 566\ngold_standard, nan\nsubject_ids, 1513299\nsubject_data, {\"1513299\":{\"retired\":{\"id\":1867768,\"workflow_id\":566,\"classifications_count\":10,\"created_at\":\"2016-04-18T19:15:47.721Z\",\"updated_at\":\"2016-04-21T18:00:08.483Z\",\"retired_at\":\"2016-04-21T18:00:08.483Z\",\"subject_id\":1513299,\"retirement_reason\":null},\"Filename\":\"20150108-KSpencer-2398.jpg\"}}\nuser_name, Sidonkey\ncreated_at, 2016-04-20 21:57:33 UTC\nworkflow_version, 4.23\nmetadata, {u'utc_offset': u'-19800', u'finished_at': u'2016-04-20T21:57:31.509Z', u'live_project': u'true', u'subject_dimensions': u'[{naturalHeight=640, clientWidth=398, clientHeight=266, naturalWidth=960}]', u'session': u'99cebea78e6d3b1d078f57129a934f4ac82b404bac1f8dd2138893ffeb89abfe', u'user_agent': u'Mozilla/5.0 (Linux; Android 5.0; Micromax A107 Build/LRX21M) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.91 Mobile Safari/537.36', u'user_language': u'en', u'user_group_ids': u'[]', u'started_at': u'2016-04-20T21:57:19.541Z', u'viewport': u'{width=320, height=544}'}\n"}]},"apps":[],"jobName":"paragraph_1497988537851_2120355918","id":"20170620-114130_1867480236","dateCreated":"2017-06-20T20:55:37+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:315"},{"text":"%sql\n\n-- create a histogram using sql\nselect ceiling(total/10)*10 as bin_floor, count(*) from (SELECT count(user_name) as total, user_name\nFROM classifications\nGROUP BY user_name\nORDER BY 1 DESC\n)\ngroup by 1\norder by 1\n","dateUpdated":"2017-06-20T20:55:38+0100","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false},"helium":{}}},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"bin_floor\tcount(1)\n10\t1826\n20\t44\n30\t9\n40\t4\n50\t1\n60\t2\n80\t2\n90\t1\n110\t1\n140\t1\n"}]},"apps":[],"jobName":"paragraph_1497988537853_2118047425","id":"20170620-144808_976534472","dateCreated":"2017-06-20T20:55:37+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:316"},{"dateUpdated":"2017-06-20T20:55:37+0100","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1497988537853_2118047425","id":"20170620-205507_925490050","dateCreated":"2017-06-20T20:55:37+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:317"},{"text":"%sql\n\n-- top user contributions\nSELECT count(user_name) as total, user_name\nFROM classifications\nGROUP BY user_name\nORDER BY 1 DESC\nLIMIT 10","user":"anonymous","dateUpdated":"2017-06-20T20:58:13+0100","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"total\tuser_name\n138\tElisabethB\n106\tchrisotahal\n84\tShamsun\n76\tScienceyGirl\n72\tZiggee\n54\tyshish\n53\tZoomify\n42\tannamlily\n40\tgabbieb\n37\tchateaumojo\n"}]},"apps":[],"jobName":"paragraph_1497988537854_2119201672","id":"20170620-182250_1617757207","dateCreated":"2017-06-20T20:55:37+0100","dateStarted":"2017-06-20T20:58:13+0100","dateFinished":"2017-06-20T20:58:15+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:318"},{"text":"%sql\n\n-- top classified subjects\nSELECT count(subject_ids) as total, subject_ids\nFROM classifications\nGROUP BY subject_ids\nORDER BY 1 DESC\nLIMIT 10","user":"anonymous","dateUpdated":"2017-06-20T21:09:01+0100","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"total\tsubject_ids\n9\t6614021\n7\t1311672\n5\t6608898\n5\t6608432\n5\t6613972\n5\t6608700\n5\t1311530\n4\t1310326\n4\t2899058\n4\t6609002\n"}]},"apps":[],"jobName":"paragraph_1497988680775_1725016295","id":"20170620-205800_1066515161","dateCreated":"2017-06-20T20:58:00+0100","dateStarted":"2017-06-20T21:09:01+0100","dateFinished":"2017-06-20T21:09:02+0100","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:319"},{"text":"%sql\n","user":"anonymous","dateUpdated":"2017-06-20T21:08:50+0100","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1497989330887_355061735","id":"20170620-210850_1731369299","dateCreated":"2017-06-20T21:08:50+0100","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:320"}],"name":"classifiation_pandas_spark_sql","id":"2CMG9AWAP","angularObjects":{"2CH63AEJ8:shared_process":[],"2CM6RJKHJ:shared_process":[],"2CHRCW21W:shared_process":[],"2CGGHTD9K:shared_process":[],"2CJPSAEUU:shared_process":[],"2CJEW3NYV:shared_process":[],"2CKKY6N3Q:shared_process":[],"2CH41CTUY:shared_process":[],"2CKAECKF5:shared_process":[],"2CGFWT3RU:shared_process":[],"2CHC9D65Q:shared_process":[],"2CM7A2D23:shared_process":[],"2CJR5CM84:shared_process":[],"2CM3MNDHB:shared_process":[],"2CJXJ2MF9:shared_process":[],"2CH1MZU8H:shared_process":[],"2CGW8K5XC:shared_process":[],"2CKJYP655:shared_process":[],"2CH2N66MA:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}